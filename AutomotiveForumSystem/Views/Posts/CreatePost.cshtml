@model PostCreateViewModel

@{
	var tagLabels = ViewData["TagLabels"] as List<Tag>;
}

<script>
	function AddTag(tag) {

	}
</script>

<div class="d-flex flex-column align-items-center " style="width: 100%;">
	<div class="d-flex" style="width:70%">
		<h4 class="text-light rounded p-2">CREATE A POST</h4>
	</div>
	<form asp-controller="Posts" asp-action="CreatePost" style="width: 70%;" method="post">

		<div class="d-flex" style="gap: 1em;">
			<div class="d-flex flex-column" style="width: 100%;">
				<div class="form-floating mb-3">
					<input asp-for="Title" type="text" id="floatingInput" placeholder="" class="form-control bg-light" required />
					<label asp-for="Title" class="form-label">Title</label>
				</div>

				<div class="form-floating mb-3">
					<textarea asp-for="Content" type="text" id="floatingInput" placeholder="" class="form-control bg-light" style="min-height: 150px;" required></textarea>
					<label asp-for="Content" class="form-label">Content</label>
				</div>
				<p style="color:white">Tags</p>
				<div class="form-floating mb-3">
					<input id="tags-input" type="text" asp-for="Tags" id="floatingInput" readonly placeholder="" class="form-control bg-light" style="cursor:default" />
					@* <label asp-for="Tags" class="form-label">Tags</label> *@
				</div>
			</div>

			<div class="bg-dark rounded mb-3 p-3">
				<div class="d-flex flex-column" style="gap: 2em">
					<div class="text-light d-flex align-items-center mb-3" style="width: 30%; gap: 0.2em;">
						@{
							foreach (var tag in tagLabels)
							{
								<button type="button" class="badge bg-info mx-1 text-dark tag-button" style="font-size:12px" data-tag="@tag.Name">@tag.Name.ToString()</button>
							}
						}
					</div>
				</div>
			</div>
		</div>

		<div class="d-flex justify-content-between p-2">
			<div class="d-flex">

				<label asp-for="CategoryID" class="form-label m-auto text-light">Category</label>
				<select asp-items="@Model.Categories" asp-for="CategoryID" class="form-select ms-2"></select>
				<span asp-validation-for="CategoryID" class="form-error"></span>

			</div>


			<div>

				<a href="@Context.Request.Headers.Referer.ToString()" style="text-decoration: none">
					<button class="btn btn-danger mx-2">Cancel</button>
				</a>

				<input type="submit" value="Create" class="btn btn-primary" />
			</div>
		</div>
	</form>
</div>

<script>
	$(document).ready(function () {
		// Initialize an array to store clicked tags
		var clickedTagsArray = [];

		// Attach click event handler to tags with class 'tag-button'
		$('.tag-button').on('click', function () {
			// Get the clicked tag's text
			var clickedTag = $(this).data('tag');

			// Add the clicked tag to the array
			if (clickedTag !== undefined && clickedTag !== null) {
				var index = clickedTagsArray.indexOf(clickedTag);

				// Check if the tag is not already in the array
				if (index === -1) {
					clickedTagsArray.push(clickedTag);
				} else {
					// Remove the tag from the array
					clickedTagsArray.splice(index, 1);
				}

				// Debug: Log the current state of the clicked tags array
				console.log(clickedTagsArray);

				// Update the input field by joining the array elements
				$('#tags-input').val(clickedTagsArray.join(' '));
			}
		});
	});
</script>