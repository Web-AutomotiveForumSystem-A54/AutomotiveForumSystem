@model PostDataViewModel

@{
	var currentUserName = Context.Session.GetString("CurrentUser");
	var postId2 = Model.Id;
}

<div class="rounded text-light p-3 overflow-hidden d-flex flex-column">
	<div class="bg-dark sticky shadow mb-4 rounded bg-opacity-100 d-flex justify-content-center row  p-3">
		<div class="d-flex justify-content-between">
			<h3>@Model.Title</h3>
			<div class="d-flex">

				@{
					if (currentUserName == Model.CreatedBy)
					{
						<a onclick="setEditPost(@Model.Id, '@Model.Title','@Model.Content')" data-bs-toggle="tooltip" data-bs-placement="top" title="Edit Post">
							<img src="~/images/icons8-edit-32.png" class="rounded-circle p-1" style="width:40px; height:40px;" />

						</a>

						<a asp-controller="Posts" asp-action="DeletePost" onclick="return confirm('Are you sure you want to delete this post?')" asp-route-postId="@postId2">

							<img src="~/images/icons8-bin-50.png" class="rounded-circle p-1 delete-button" style="width:40px; height:40px;" />
						</a>
					}
				}
			</div>


		</div>
		<h5>@Model.Content</h5>

		<div class="d-flex justify-content-between mb-md-2">
			<div class="d-flex flex-column justify-content-between mt-4">
				<div class="d-flex">
					<img src="~/images/user-128-dark.png" class="bg-light rounded-circle p-1" style="max-width:28px; max-height:28px" />
					<p class="ps-2">@Model.CreatedBy</p>
				</div>
				<div>
					<p class="mb-md-0">@Model.CreateDate</p>
				</div>
			</div>
			@{
				if (currentUserName != null)
				{
					<div class="d-flex flex-column mb-md-0 justify-content-end login-button-container m-2">
						<button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#createReply">Post reply</button>
					</div>
				}
				else
				{
					<div class="d-flex flex-column mb-md-0 justify-content-end login-button-container m-2">
						<a asp-controller="Auth" asp-action="Login" type="button" class="btn btn-primary">Post reply</a>
					</div>
				}


			}
		</div>
	</div>
	<div>

		<!-- POST REPLY -->
		<div class="modal fade" id="createReply" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
			<div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
				<div class="modal-content">
					<div class="modal-body">
						<p class="bg-dark p-2">POST A REPLY</p>
						<form asp-controller="Posts" asp-action="CreateComment" asp-route-postId="@postId2" method="post">
							<div class="form-floating mb-3">
								<textarea asp-for="@Model.Comment.Content" type="text" id="floatingInput" placeholder="Reply here" class="form-control" style="min-height:200px;" required></textarea>
							</div>
							<div class="d-flex justify-content-center login-button-container">
								<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
								<input type="submit" value="Create" class="btn btn-primary ms-5" />
							</div>
						</form>
					</div>
				</div>
			</div>
		</div>

		<!-- EDIT COMMENT -->
		<div class="modal fade" id="editComment" tabindex="-1" aria-labelledby="editCommentLabel" aria-hidden="true">
			<div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
				<div class="modal-content">
					<div class="modal-body">
						<p class="bg-dark p-2">EDIT COMMENT</p>
						<form asp-controller="Posts" asp-action="UpdateComment" asp-route-commentId="@Model.Comment.CommentID" id="editCommentForm" method="post">

							<div class="form-floating mb-3">
								<textarea asp-for="@Model.Comment.Content" type="text" id="editCommentContent" placeholder="Reply here" class="form-control" style="min-height:200px;" required></textarea>
							</div>
							<div class="d-flex justify-content-center login-button-container">
								<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
								<input type="submit" value="Create" class="btn btn-primary ms-5" />
							</div>
						</form>
					</div>
				</div>
			</div>
		</div>

		<!-- EDIT POST -->
		<div class="modal fade" id="editPost" tabindex="-1" aria-labelledby="editPostLabel" aria-hidden="true">
			<div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
				<div class="modal-content">
					<div class="modal-body">
						<p class="bg-dark p-2">EDIT POST</p>
						<form asp-controller="Posts" asp-action="UpdatePost" asp-route-postId="@Model.Id" id="editPostForm" method="post">
							<input type="hidden" asp-for="@Model.CategoryId" />

							<div class="form-floating mb-3">
								<textarea asp-for="@Model.Title" type="text" id="editPostTitle" placeholder="Title" class="form-control" style="height: 100px;" required></textarea>
								<textarea asp-for="@Model.Content" type="text" id="editPostContent" placeholder="Content" class="form-control" style="height:200px;" required></textarea>
							</div>
							<div class="d-flex justify-content-center login-button-container">
								<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
								<input type="submit" value="Edit" class="btn btn-primary ms-5" />
							</div>
						</form>
					</div>
				</div>
			</div>
		</div>

	</div>

	<div>
		@{
			<hr />

			if (Model.Comments.Count == 0)
			{
				<h2>Be the first to comment!</h2>
			}
			foreach (var comment in Model.Comments)
			{
				<div class="bg-secondary shadow sticky mb-4 bg-opacity-25 d-flex row justify-content-between rounded-3 m-2 p-3">
					<p>@comment.Content</p>
					<div>
						<div class="d-flex align-items-end justify-content-between">
							<div>
								<img src="~/images/user-128-dark.png" class="bg-light rounded-circle p-1" style="max-width:28px; max-height:28px" />
								<label class="col text-start m-auto ps-2">@comment.User.UserName</label>
							</div>
							<div>
								@{
									if (currentUserName != null && currentUserName == comment.User.UserName)
									{
										<a onclick="setEditComment(@comment.Id, '@comment.Content')" data-bs-toggle="tooltip" data-bs-placement="top" title="Edit">
											<img src="~/images/icon-edit.png" ps-2 src="~/images/icon-edit.png" class="bg-primary rounded-circle p-1" style="width:28px; height:28px" />

										</a>
										// <button type="button" class="btn btn-primary" onclick="setEditComment(@comment.Id, '@comment.Content')">Edit</button>
									}
								}
								<label class="col text-end ps-2 m-auto">@comment.CreateDate.ToString("MM.dd HH:mm")</label>
							</div>
						</div>
					</div>
				</div>
				<hr />
			}
		}
	</div>
</div>